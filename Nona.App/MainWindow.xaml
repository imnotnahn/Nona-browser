<Window x:Class="Nona.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
         xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        xmlns:local="clr-namespace:Nona.App"
        mc:Ignorable="d"
         Title="Nona" Height="700" Width="1100" WindowStartupLocation="CenterScreen"
         Background="Transparent"
         UseLayoutRounding="True"

         TextOptions.TextFormattingMode="Display"
         TextOptions.TextRenderingMode="ClearType">
    <Grid>
        <!-- Background Image Layer -->
        <Image x:Name="BackgroundImage" 
               Stretch="{DynamicResource BackgroundImageStretch}"
               Opacity="{DynamicResource BackgroundImageOpacity}"
               Visibility="Collapsed"
               Panel.ZIndex="0"/>
        
        <Grid Panel.ZIndex="1" Background="{DynamicResource BackgroundColor}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
        <Border Grid.Row="0" Background="{DynamicResource MenuColor}" 
                BorderBrush="{DynamicResource WindowBorderColor}" 
                BorderThickness="0,0,0,1"
                Effect="{DynamicResource DropShadowEffect}">
            <DockPanel LastChildFill="True" Margin="12,6">
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                    <!-- Tab List Button -->
                    <Button x:Name="TabListButton" Width="32" Height="32" Margin="0,0,8,0" Click="TabList_Click"
                            Style="{DynamicResource DropdownButtonStyle}" ToolTip="Show Tab List"
                            Content="☰" FontSize="14" FontWeight="Bold"/>
                    <Popup x:Name="TabListPopup" PlacementTarget="{Binding ElementName=TabListButton}" 
                           Placement="Bottom" StaysOpen="False" AllowsTransparency="True"
                           PopupAnimation="Fade">
                        <Border Background="{DynamicResource MenuColor}"
                                BorderBrush="{DynamicResource WindowBorderColor}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="4"
                                MinWidth="250"
                                MaxHeight="300"
                                Effect="{DynamicResource DropShadowEffect}">
                            <ScrollViewer x:Name="TabListScrollViewer" Style="{DynamicResource MenuScrollViewerStyle}">
                                <StackPanel x:Name="TabListContainer" Orientation="Vertical"/>
                            </ScrollViewer>
                        </Border>
                    </Popup>
                    
                    <!-- Navigation buttons with simple text icons -->
                    <Button Width="32" Height="32" Margin="0,0,4,0" Click="Back_Click"
                            Style="{DynamicResource ModernButtonStyle}" ToolTip="Go Back (Alt+Left)"
                            Content="‹" FontSize="18" FontWeight="Bold"/>
                    <Button Width="32" Height="32" Margin="0,0,4,0" Click="Forward_Click"
                            Style="{DynamicResource ModernButtonStyle}" ToolTip="Go Forward (Alt+Right)"
                            Content="›" FontSize="18" FontWeight="Bold"/>
                    <Button Width="32" Height="32" Margin="0,0,12,0" Click="Reload_Click"
                            Style="{DynamicResource ModernButtonStyle}" ToolTip="Reload (F5)"
                            Content="↻" FontSize="14" FontWeight="Bold"/>
                </StackPanel>
                
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
                    <!-- Menu Button -->
                    <Button x:Name="MenuButton" Width="32" Height="32" Margin="4,0,0,0" Click="Menu_Click"
                            Style="{DynamicResource DropdownButtonStyle}" ToolTip="Menu"
                            Content="⋮" FontSize="18" FontWeight="Bold">
                        <Button.ContextMenu>
                            <ContextMenu x:Name="MainContextMenu" Style="{DynamicResource DropdownMenuStyle}">
                                <MenuItem Header="New Tab" Click="NewTab_Click" Style="{DynamicResource ModernMenuItemStyle}">
                                    <MenuItem.Icon>
                                        <TextBlock Text="+" FontSize="14" FontWeight="Bold" 
                                                 Foreground="{DynamicResource ForegroundColor}"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <MenuItem Header="Home" Click="Home_Click" Style="{DynamicResource ModernMenuItemStyle}">
                                    <MenuItem.Icon>
                                        <TextBlock Text="⌂" FontSize="12" 
                                                 Foreground="{DynamicResource ForegroundColor}"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <Separator Style="{DynamicResource ModernSeparatorStyle}"/>
                                <MenuItem Header="Add Bookmark" Click="AddBookmark_Click" Style="{DynamicResource ModernMenuItemStyle}">
                                    <MenuItem.Icon>
                                        <TextBlock Text="★" FontSize="12" 
                                                 Foreground="{DynamicResource ForegroundColor}"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <MenuItem Header="Toggle Bookmark Bar" Click="ToggleBookmarkBar_Click" Style="{DynamicResource ModernMenuItemStyle}">
                                    <MenuItem.Icon>
                                        <TextBlock Text="☰" FontSize="12" 
                                                 Foreground="{DynamicResource ForegroundColor}"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <Separator Style="{DynamicResource ModernSeparatorStyle}"/>
                                <MenuItem Header="History" Click="OpenHistory_Click" Style="{DynamicResource ModernMenuItemStyle}">
                                    <MenuItem.Icon>
                                        <TextBlock Text="⟲" FontSize="12" 
                                                 Foreground="{DynamicResource ForegroundColor}"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <MenuItem Header="Settings" Click="OpenSettings_Click" Style="{DynamicResource ModernMenuItemStyle}">
                                    <MenuItem.Icon>
                                        <TextBlock Text="⚙" FontSize="12" 
                                                 Foreground="{DynamicResource ForegroundColor}"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <MenuItem Header="Profiles" Click="OpenProfiles_Click" Style="{DynamicResource ModernMenuItemStyle}">
                                    <MenuItem.Icon>
                                        <TextBlock Text="👤" FontSize="12" 
                                                 Foreground="{DynamicResource ForegroundColor}"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <Separator Style="{DynamicResource ModernSeparatorStyle}"/>
                                <MenuItem Header="Developer Tools" Click="DevTools_Click" Style="{DynamicResource ModernMenuItemStyle}">
                                    <MenuItem.Icon>
                                        <TextBlock Text="⚒" FontSize="12" 
                                                 Foreground="{DynamicResource ForegroundColor}"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                            </ContextMenu>
                        </Button.ContextMenu>
                    </Button>
                </StackPanel>
                
                <!-- Enhanced address bar -->
                <Border Margin="12,0" Background="{DynamicResource TextBoxColor}" 
                        BorderBrush="{DynamicResource TextBoxBorderColor}" 
                        BorderThickness="1" CornerRadius="16" Height="32"
                        Effect="{DynamicResource DropShadowEffect}">
                    <Grid>
                        <!-- Security indicator -->
                        <TextBlock Text="🔒" HorizontalAlignment="Left" VerticalAlignment="Center" 
                                   Margin="10,0,0,0" FontSize="10"
                                   Foreground="{DynamicResource AccentColor}"/>
                        
                        <TextBox x:Name="Omnibox" KeyDown="Omnibox_KeyDown"
                                 Background="Transparent" BorderThickness="0"
                                 Foreground="{DynamicResource ForegroundColor}"
                                 FontSize="13" VerticalContentAlignment="Center"
                                 Padding="30,0,40,0"
                                 Text="Search or enter website name"/>
                        
                        <!-- Go button with simple styling -->
                        <Button Content="→" Width="32" Height="24" Click="Go_Click"
                                HorizontalAlignment="Right" Margin="0,4,4,4"
                                Style="{DynamicResource AccentButtonStyle}"
                                FontSize="14" FontWeight="Bold"/>
                    </Grid>
                </Border>
            </DockPanel>
        </Border>
        <Border x:Name="BookmarkBarBorder" Grid.Row="1" Background="{DynamicResource BookmarkBarColor}" 
                BorderBrush="{DynamicResource WindowBorderColor}" 
                BorderThickness="0,0,0,1"
                Visibility="Collapsed">
            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled" Height="32">
                <StackPanel Orientation="Horizontal" x:Name="BookmarkBar" Margin="8,4"/>
            </ScrollViewer>
        </Border>
        <TabControl x:Name="Tabs" Grid.Row="2" SelectionChanged="Tabs_SelectionChanged"
                    Style="{DynamicResource HiddenTabControlStyle}"/>
        </Grid>
    </Grid>
    <Window.CommandBindings>
        <CommandBinding Command="ApplicationCommands.New" Executed="NewTab_Executed"/>
        <CommandBinding Command="ApplicationCommands.Close" Executed="CloseTab_Executed"/>
        <CommandBinding Command="NavigationCommands.GoToPage" Executed="FocusOmnibox_Executed"/>
        <CommandBinding Command="ApplicationCommands.Properties" Executed="OpenDownloads_Executed"/>
        <CommandBinding Command="ApplicationCommands.Find" Executed="OpenHistory_Executed"/>
        <CommandBinding Command="NavigationCommands.BrowseBack" Executed="GoBack_Executed"/>
        <CommandBinding Command="{x:Static local:MainWindow.OpenCommandPalette}" Executed="OpenCommandPalette_Executed"/>
    </Window.CommandBindings>
    <Window.InputBindings>
        <KeyBinding Modifiers="Control" Key="T" Command="ApplicationCommands.New"/>
        <KeyBinding Modifiers="Control" Key="W" Command="ApplicationCommands.Close"/>
        <KeyBinding Modifiers="Control" Key="L" Command="NavigationCommands.GoToPage"/>
        <KeyBinding Modifiers="Control" Key="J" Command="ApplicationCommands.Properties"/>
        <KeyBinding Modifiers="Control" Key="H" Command="ApplicationCommands.Find"/>
        <KeyBinding Modifiers="Control" Key="B" Command="NavigationCommands.BrowseBack"/>
        <KeyBinding Modifiers="Control" Key="K" Command="{x:Static local:MainWindow.OpenCommandPalette}"/>
        <KeyBinding Modifiers="Control" Key="F5" Command="{x:Static local:MainWindow.HardRefreshCommand}"/>
        <KeyBinding Key="F5" Command="NavigationCommands.Refresh"/>
        <KeyBinding Modifiers="Control" Key="R" Command="NavigationCommands.Refresh"/>
        <KeyBinding Modifiers="Alt" Key="Left" Command="NavigationCommands.BrowseBack"/>
        <KeyBinding Modifiers="Alt" Key="Right" Command="NavigationCommands.BrowseForward"/>
    </Window.InputBindings>
</Window>
